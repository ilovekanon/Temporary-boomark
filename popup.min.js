var bookmarks=[];var now=Math.round(new Date().getTime()/1000);var settings={};var bangBookmark={init:function(){var d=this;settings={};var e=localStorage.getItem("bang_bookmark_list");var a=localStorage.getItem("bang_bookmark_setting");if(typeof(a)!="undefined"&&a!=null&&a!="null"){settings=JSON.parse(a)}if(typeof(settings.expireDay)=="undefined"||settings.expireDay==null||settings.expireDay=="null"||settings.expireDay==""){settings.expireDay=7}$("#bang_schedule_input").val(settings.expireDay);if(typeof(e)=="undefined"||e==null||e=="null"||e==""){bookmarks=[]}else{var c=JSON.parse(e);preBookmarkLength=c.length;for(var b=0;b<preBookmarkLength;b++){if(c[b].expire>now){bookmarks.push(c[b]);d.addView(c[b])}}}},addView:function(b){var c=parseInt((b.expire-now)/86400);var a="<li id='bang_list_"+b.id+"'>";a+="<div class='bang_float_left'><img src='"+b.favIconUrl+"' class='bang_favIcon' title='"+c+" day remains'/></div>";a+="<div class='bang_float_left bang_title_area'><a href='javascript:;' data-id='"+b.url+"' class='bang_link_title' title='"+b.fullTitle+"' tabindex='-1'>"+b.title+"</a></div>";a+="<div class='bang_float_right bang_remove_btn_wrap'>";a+="<img src='delete_icon.png' title='Remove' alt='Remove' class='bang_delete_icon' data-id='"+b.id+"'/>";a+="<span class='remain_day' title='"+c+" day remains'>"+c+"</span>";a+="</div>";a+="<br class='bang_clear' /></li>";$("#bang_bookmark_list").append(a);$("#bang_bookmark_list").scrollTop($("#bang_bookmark_list").innerHeight())},addToList:function(){var a=this;chrome.tabs.query({active:true,currentWindow:true},function(h){var f=h[0];var k;var b=40;if(f.title.length>b){k=f.title.substring(0,b)+"..."}else{k=f.title}var i=f.title;var d=Math.round(new Date().getTime()/1000);var j=d+Math.floor((1+Math.random())*65536).toString(16);var g;if(typeof(f.favIconUrl)=="undefined"||!f.favIconUrl){g="https://www.google.com/images/icons/product/chrome-32.png"}else{g=f.favIconUrl}a.checkDuplicatedUrl(f.url);var c=d+(60*60*24*settings.expireDay);var e={id:j,url:f.url,title:k,fullTitle:i,favIconUrl:g,updated:d,expire:c};bookmarks.push(e);a.addView(e);a.commit()})},checkDuplicatedUrl:function(a){bookmarkLength=bookmarks.length;for(var b=0;b<bookmarkLength;b++){if(bookmarks[b].url==a){$("#bang_list_"+bookmarks[b].id).fadeOut("fast");bookmarks.splice(b,1);break}}},removeFromList:function(c){var a=$(c.target).attr("data-id");bookmarkLength=bookmarks.length;for(var b=0;b<bookmarkLength;b++){if(bookmarks[b].id==a){bookmarks.splice(b,1);break}}$("#bang_list_"+a).fadeOut("fast");this.commit()},commit:function(){bookmarks=bookmarks.filter(function(a){return a!=undefined});bookmarks.sort(function(d,c){if(d.expire<c.expire){return -1}if(d.expire>c.expire){return 1}return 0});localStorage.setItem("bang_bookmark_list",JSON.stringify(bookmarks));localStorage.setItem("bang_bookmark_setting",JSON.stringify(settings))},movetoSetting:function(){var a;if(parseInt($("#bang_body_wrap").css("margin-left"))==0){a="-350px";$("#bang_setting_notice_wrap").hide();$("#bang_bookmark_list").css("max-height","100px");$("#bang_seetingBtn").attr("src","/images/list_white.png");$("#bang_addBtn").hide();$("#bang_saveSettingBtn").show()}else{a="0px";$("#bang_bookmark_list").css("max-height","350px");$("#bang_seetingBtn").attr("src","/images/setting_white.png");$("#bang_saveSettingBtn").hide();$("#bang_addBtn").show()}$("#bang_body_wrap").animate({marginLeft:a},200)},setSetting:function(){var a=$("#bang_schedule_input").val();$("#bang_setting_notice_wrap").hide();if(!a){$("#bang_setting_notice_wrap").removeClass("bang_notice").addClass("bang_error").text("Invaild value you input.").show();$("#bang_schedule_input").val(settings.expireDay);return false}if(a<1||a>14){$("#bang_setting_notice_wrap").removeClass("bang_notice").addClass("bang_error").text("Please type in between 1 and 14.").show();$("#bang_schedule_input").val(settings.expireDay);return false}if(settings.expireDay!=a){settings.expireDay=a;this.commit()}$("#bang_setting_notice_wrap").removeClass("bang_error").addClass("bang_notice").text("Setting has been saved.").show()},openTab:function(b){var a=$(b.target).attr("data-id");chrome.tabs.create({url:a})},localizeHtmlPage:function(){var c=document.getElementsByTagName("html");for(var a=0;a<c.length;a++){var d=c[a];var e=d.innerHTML.toString();var b=e.replace(/__MSG_(\w+)__/g,function(f,g){return g?chrome.i18n.getMessage(g):""});if(b!=e){d.innerHTML=b}}}};document.addEventListener("DOMContentLoaded",function(){bangBookmark.localizeHtmlPage();bangBookmark.init();$("#bang_addBtn").on("click",function(){bangBookmark.addToList()});$("#bang_seetingBtn").on("click",function(){bangBookmark.movetoSetting()});$(document).on("click","#bang_saveSettingBtn",function(){bangBookmark.setSetting()});$(document).on("change","#bang_schedule_input",function(){bangBookmark.setSetting()});$(document).on("click",".bang_delete_icon",function(a){bangBookmark.removeFromList(a)});$(document).on("click",".bang_link_title",function(a){bangBookmark.openTab(a)})});window.addEventListener("unload",function(){bangBookmark.commit()},false);